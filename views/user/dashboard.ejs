<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - SmartPark</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #7209b7;
      --success: #4cc9f0;
      --info: #4895ef;
      --warning: #f72585;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --border: #e9ecef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: 
        /* Gradient overlay for better readability */
        linear-gradient(135deg, rgba(102, 126, 234, 0.85) 0%, rgba(118, 75, 162, 0.85) 100%),
        /* Background image */
        url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2069&q=80') 
        center/cover no-repeat fixed;
      min-height: 100vh;
      color: #2d3748;
      line-height: 1.6;
    }

    /* Alternative background image options - uncomment one of these if you prefer: */
    
    /* Option 2: Modern parking garage */
    /*
    body {
      background: 
        linear-gradient(135deg, rgba(67, 97, 238, 0.9) 0%, rgba(114, 9, 183, 0.9) 100%),
        url('https://images.unsplash.com/photo-1543489822-c49534f0ad53?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') 
        center/cover no-repeat fixed;
    }
    */
    
    /* Option 3: Car in parking lot */
    /*
    body {
      background: 
        linear-gradient(135deg, rgba(67, 97, 238, 0.85) 0%, rgba(114, 9, 183, 0.85) 100%),
        url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80') 
        center/cover no-repeat fixed;
    }
    */

    .dashboard-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .dashboard-main {
      flex: 1;
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      margin-left: 250px; /* Account for sidebar */
    }

    /* Welcome Section */
    .welcome-section {
      text-align: center;
      margin-bottom: 3rem;
      color: white;
      position: relative;
      z-index: 2;
    }

    .welcome-section h1 {
      font-size: 2.75rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #fff 0%, #e0f7fa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .welcome-subtitle {
      font-size: 1.25rem;
      opacity: 0.95;
      font-weight: 400;
      margin-bottom: 1rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .role-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
      position: relative;
      z-index: 2;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.4), 
        transparent);
      transition: left 0.6s ease;
    }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.2),
        0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .stat-card:hover::before {
      left: 100%;
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
    }

    .stat-trend {
      font-size: 0.875rem;
      font-weight: 600;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      background: rgba(76, 201, 240, 0.1);
      color: var(--success);
    }

    .trend-up { color: #10b981; background: rgba(16, 185, 129, 0.1); }
    .trend-down { color: #ef4444; background: rgba(239, 68, 68, 0.1); }

    .stat-content h3 {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 0.5rem;
      line-height: 1;
    }

    .stat-label {
      color: var(--gray);
      font-weight: 500;
      font-size: 0.95rem;
    }

    /* Quick Actions */
    .quick-actions {
      margin-bottom: 2.5rem;
      position: relative;
      z-index: 2;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .action-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      text-decoration: none;
      color: inherit;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.4), 
        transparent);
      transition: left 0.6s ease;
    }

    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 
        0 16px 32px rgba(0, 0, 0, 0.2),
        0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .action-card:hover::before {
      left: 100%;
    }

    .action-card.primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .action-card.primary .action-title,
    .action-card.primary .action-description {
      color: white;
    }

    .action-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      background: rgba(255, 255, 255, 0.2);
      color: var(--primary);
    }

    .action-card.primary .action-icon {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .action-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .action-description {
      color: var(--gray);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    /* Recent Activity */
    .recent-activity {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.15),
        0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.4);
      position: relative;
      z-index: 2;
    }

    .activity-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .activity-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .view-all {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      transition: color 0.2s ease;
    }

    .view-all:hover {
      color: var(--primary-dark);
    }

    .activity-list {
      display: grid;
      gap: 1rem;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      background: rgba(248, 249, 250, 0.8);
      border-radius: 16px;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .activity-item:hover {
      background: rgba(248, 249, 250, 1);
      border-color: var(--border);
      transform: translateX(4px);
    }

    .activity-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title-text {
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .activity-time {
      font-size: 0.875rem;
      color: var(--gray);
    }

    .status-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-active {
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .status-completed {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.1);
      color: #f59e0b;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--gray);
    }

    .empty-icon {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-text {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .empty-subtext {
      font-size: 0.95rem;
      opacity: 0.7;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stat-card, .action-card {
      animation: fadeInUp 0.6s ease-out;
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }
    .action-card:nth-child(1) { animation-delay: 0.2s; }
    .action-card:nth-child(2) { animation-delay: 0.3s; }
    .action-card:nth-child(3) { animation-delay: 0.4s; }
    .action-card:nth-child(4) { animation-delay: 0.5s; }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .dashboard-main {
        padding: 1.5rem;
        margin-left: 0;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
      
      body {
        background-attachment: scroll; /* Remove fixed background on mobile */
      }
    }

    @media (max-width: 768px) {
      .dashboard-main {
        padding: 1rem;
        margin-left: 0;
      }

      .welcome-section h1 {
        font-size: 2.25rem;
      }

      .stat-card, .action-card {
        padding: 1.5rem;
      }

      .stat-content h3 {
        font-size: 2rem;
      }

      .actions-grid {
        grid-template-columns: 1fr;
      }

      .section-title {
        font-size: 1.25rem;
      }
    }

    @media (max-width: 480px) {
      .welcome-section h1 {
        font-size: 2rem;
      }

      .welcome-subtitle {
        font-size: 1.1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .stat-card {
        padding: 1.25rem;
      }
    }

    /* Loading States */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 4px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      animation: slideInRight 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .notification.success {
      background: rgba(16, 185, 129, 0.9);
    }

    .notification.warning {
      background: rgba(239, 68, 68, 0.9);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <%- include("../patials/_dashnav") %>
  
  <div class="dashboard-wrapper">
    <!-- Header -->
    <%- include("../patials/_header") %>

    <main class="dashboard-main">
      <!-- Welcome Section -->
      <div class="welcome-section">
        <h1>Welcome back, <%= user.username %>! ðŸ‘‹</h1>
        <p class="welcome-subtitle">
          <% if (isCustomer) { %>
            Here's your personalized parking overview
          <% } else { %>
            Parking management dashboard
          <% } %>
        </p>
        <div class="role-chip">
          <i class="fas fa-user-shield"></i>
          <%= user.role.toUpperCase() %>
        </div>
      </div>

      <!-- Statistics Grid -->
      <div class="stats-grid">
        <% if (isAdmin || isOperator) { %>
          <!-- Admin/Operator Stats -->
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-trend trend-up">+5%</div>
            </div>
            <div class="stat-content">
              <h3><%= stats.totalCustomers || 0 %></h3>
              <p class="stat-label">Total Customers</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-car"></i>
              </div>
              <div class="stat-trend trend-up">+3%</div>
            </div>
            <div class="stat-content">
              <h3><%= stats.totalVehicles || 0 %></h3>
              <p class="stat-label">Registered Vehicles</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-parking"></i>
              </div>
              <div class="stat-trend">
                <% if (stats.totalSlots > 0) { %>
                  <%= Math.round((stats.availableSlots / stats.totalSlots) * 100) %>%
                <% } %>
              </div>
            </div>
            <div class="stat-content">
              <h3><%= stats.availableSlots || 0 %>/<%= stats.totalSlots || 0 %></h3>
              <p class="stat-label">Available Slots</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="stat-trend trend-up">
                Ksh <%= parseFloat(stats.todayRevenue || 0).toLocaleString() %>
              </div>
            </div>
            <div class="stat-content">
              <h3><%= stats.activeSessions || 0 %></h3>
              <p class="stat-label">Active Sessions</p>
            </div>
          </div>
        <% } else { %>
          <!-- Customer Stats -->
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-car"></i>
              </div>
              <div class="stat-trend">
                <% if (stats.totalVehicles > 0) { %>
                  <%= stats.totalVehicles %> registered
                <% } else { %>
                  Add vehicle
                <% } %>
              </div>
            </div>
            <div class="stat-content">
              <h3><%= stats.totalVehicles || 0 %></h3>
              <p class="stat-label">My Vehicles</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-parking"></i>
              </div>
              <div class="stat-trend">
                <% if (stats.activeSessions > 0) { %>
                  Currently parked
                <% } else { %>
                  No active sessions
                <% } %>
              </div>
            </div>
            <div class="stat-content">
              <h3><%= stats.activeSessions || 0 %></h3>
              <p class="stat-label">Active Parking</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-trend">
                <% if (stats.upcomingReservations > 0) { %>
                  <%= stats.upcomingReservations %> booked
                <% } else { %>
                  No reservations
                <% } %>
              </div>
            </div>
            <div class="stat-content">
              <h3><%= stats.upcomingReservations || 0 %></h3>
              <p class="stat-label">Upcoming Reservations</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="stat-trend">
                <% if (stats.totalSpent && stats.totalSpent > 0) { %>
                  Ksh <%= parseFloat(stats.totalSpent).toLocaleString() %>
                <% } else { %>
                  View history
                <% } %>
              </div>
            </div>
            <div class="stat-content">
              <h3>Ksh <%= stats.totalSpent ? parseFloat(stats.totalSpent).toLocaleString() : '0' %></h3>
              <p class="stat-label">Total Spending</p>
            </div>
          </div>
        <% } %>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <h2 class="section-title">
          <i class="fas fa-bolt"></i>
          Quick Actions
        </h2>
        <div class="actions-grid">
          <% if (isAdmin || isOperator) { %>
            <!-- Admin/Operator Actions -->
            <a href="/admin/customers" class="action-card">
              <div class="action-icon">
                <i class="fas fa-users"></i>
              </div>
              <h3 class="action-title">Manage Customers</h3>
              <p class="action-description">View and manage customer records and information</p>
            </a>

            <a href="/admin/vehicles" class="action-card">
              <div class="action-icon">
                <i class="fas fa-car"></i>
              </div>
              <h3 class="action-title">Vehicle Management</h3>
              <p class="action-description">Handle registered vehicles and license plates</p>
            </a>

            <a href="/admin/sessions" class="action-card">
              <div class="action-icon">
                <i class="fas fa-clock"></i>
              </div>
              <h3 class="action-title">Parking Sessions</h3>
              <p class="action-description">Monitor active sessions and parking history</p>
            </a>

            <a href="/admin/reservations" class="action-card">
              <div class="action-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <h3 class="action-title">Reservations</h3>
              <p class="action-description">Manage bookings and scheduling</p>
            </a>
          <% } else { %>
            <!-- Customer Actions -->
            <a href="/user/vehicles" class="action-card">
              <div class="action-icon">
                <i class="fas fa-car"></i>
              </div>
              <h3 class="action-title">My Vehicles</h3>
              <p class="action-description">Manage your registered vehicles and license plates</p>
            </a>

            <a href="/user/reservations" class="action-card">
              <div class="action-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <h3 class="action-title">My Reservations</h3>
              <p class="action-description">View and manage your parking bookings</p>
            </a>

            <a href="/user/sessions" class="action-card primary">
              <div class="action-icon">
                <i class="fas fa-parking"></i>
              </div>
              <h3 class="action-title">Parking History</h3>
              <p class="action-description">View your parking sessions and payment history</p>
            </a>

            <a href="/user/reservations" class="action-card primary">
              <div class="action-icon">
                <i class="fas fa-calendar-plus"></i>
              </div>
              <h3 class="action-title">Book Slot</h3>
              <p class="action-description">Reserve a parking slot for future use</p>
            </a>
          <% } %>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="recent-activity">
        <div class="activity-header">
          <h2 class="activity-title">
            <i class="fas fa-history"></i>
            Recent Activity
          </h2>
          <a href="/user/sessions" class="view-all">
            View All <i class="fas fa-chevron-right"></i>
          </a>
        </div>

        <div class="activity-list">
          <% if (recentActivity && recentActivity.length > 0) { %>
            <% recentActivity.slice(0, 6).forEach(activity => { %>
              <div class="activity-item">
                <div class="activity-icon">
                  <% if (activity.exit_time) { %>
                    <i class="fas fa-sign-out-alt"></i>
                  <% } else { %>
                    <i class="fas fa-car"></i>
                  <% } %>
                </div>
                <div class="activity-content">
                  <div class="activity-title-text">
                    Vehicle <%= activity.license_plate %> 
                    <% if (activity.exit_time) { %>
                      exited slot <%= activity.slot_number %>
                    <% } else { %>
                      parked in slot <%= activity.slot_number %>
                    <% } %>
                    <span class="status-badge <%= activity.exit_time ? 'status-completed' : 'status-active' %>">
                      <%= activity.exit_time ? 'Completed' : 'Active' %>
                    </span>
                  </div>
                  <div class="activity-time">
                    <%= new Date(activity.entry_time).toLocaleString() %>
                    <% if (activity.total_fee > 0) { %>
                      â€¢ Ksh <%= parseFloat(activity.total_fee).toLocaleString() %>
                    <% } %>
                    <% if (activity.customer_name && (isAdmin || isOperator)) { %>
                      â€¢ <%= activity.customer_name %>
                    <% } %>
                  </div>
                </div>
              </div>
            <% }) %>
          <% } else if (recentSessions && recentSessions.length > 0) { %>
            <% recentSessions.slice(0, 5).forEach(session => { %>
              <div class="activity-item">
                <div class="activity-icon">
                  <% if (session.exit_time) { %>
                    <i class="fas fa-sign-out-alt"></i>
                  <% } else { %>
                    <i class="fas fa-car"></i>
                  <% } %>
                </div>
                <div class="activity-content">
                  <div class="activity-title-text">
                    Vehicle <%= session.license_plate %> in slot <%= session.slot_number %>
                    <span class="status-badge <%= session.exit_time ? 'status-completed' : 'status-active' %>">
                      <%= session.exit_time ? 'Completed' : 'Active' %>
                    </span>
                  </div>
                  <div class="activity-time">
                    <%= new Date(session.entry_time).toLocaleString() %>
                    <% if (session.total_fee > 0) { %>
                      â€¢ Ksh <%= parseFloat(session.total_fee).toLocaleString() %>
                    <% } %>
                  </div>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-chart-bar"></i>
              </div>
              <p class="empty-text">No recent activity</p>
              <p class="empty-subtext">
                <% if (isCustomer) { %>
                  Your parking sessions will appear here once you start parking
                <% } else { %>
                  System activities will appear here as they occur
                <% } %>
              </p>
            </div>
          <% } %>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <%- include("../patials/_footer") %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Enhanced card interactions
      const cards = document.querySelectorAll('.stat-card, .action-card');
      cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });

        // Click animation for action cards
        if (card.classList.contains('action-card')) {
          card.addEventListener('click', function(e) {
            if (this.getAttribute('href')) {
              this.style.transform = 'scale(0.98)';
              setTimeout(() => {
                this.style.transform = '';
              }, 150);
            }
          });
        }
      });

      // Auto-refresh for admin/operator dashboard
      <% if (isAdmin || isOperator) { %>
      setInterval(() => {
        refreshDashboardData();
      }, 30000);
      <% } %>

      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case '1':
              e.preventDefault();
              window.location.href = '/dashboard';
              break;
            case '2':
              e.preventDefault();
              window.location.href = '<%= isAdmin || isOperator ? "/admin/vehicles" : "/user/vehicles" %>';
              break;
            case '3':
              e.preventDefault();
              window.location.href = '<%= isAdmin || isOperator ? "/admin/sessions" : "/user/sessions" %>';
              break;
          }
        }
      });

      // Online/offline detection
      function updateOnlineStatus() {
        if (navigator.onLine) {
          showNotification('Connection restored', 'success');
        } else {
          showNotification('You are offline', 'warning');
        }
      }

      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);

      function showNotification(message, type) {
        // Remove existing notifications
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => notification.remove());

        // Create and show notification
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
          <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
          ${message}
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 4000);
      }

      // Real-time stats updates for customers
      <% if (isCustomer) { %>
      function updateCustomerStats() {
        // Simulate real-time updates for customer dashboard
        const activeSessions = <%= stats.activeSessions || 0 %>;
        const upcomingReservations = <%= stats.upcomingReservations || 0 %>;
        
        // Update active sessions count if needed
        const activeSessionsElement = document.querySelector('.stat-card:nth-child(2) .stat-content h3');
        if (activeSessionsElement) {
          // This would typically come from an API call
          // For now, we'll just update the display
          console.log('Updating customer dashboard stats...');
        }
      }
      
      // Update customer stats every 30 seconds
      setInterval(updateCustomerStats, 30000);
      <% } %>

      // Add CSS for slide-in animation if not already present
      if (!document.querySelector('#notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          @keyframes slideInRight {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `;
        document.head.appendChild(style);
      }
    });

    function refreshDashboardData() {
      // Implement AJAX call to refresh dashboard data
      console.log('Refreshing dashboard data...');
      // fetch('/api/dashboard/stats').then(...)
      
      // For now, just reload the page
      window.location.reload();
    }

    // Service Worker registration for PWA functionality
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('SW registered: ', registration);
        })
        .catch(registrationError => {
          console.log('SW registration failed: ', registrationError);
        });
    }
  </script>
</body>
</html>